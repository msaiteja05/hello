<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Birthday!</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font import from Google Fonts */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Hide scrollbars for a cleaner look */
        body::-webkit-scrollbar {
            display: none;
        }
        .container-bg {
            background: radial-gradient(circle, #6d28d9 0%, #4c1d95 100%);
        }
        .camera-video {
            transform: scaleX(-1); /* Flip the camera view horizontally */
        }
    </style>
</head>
<body class="container-bg h-screen flex items-center justify-center text-white p-4">

    <!-- Main Container -->
    <div id="app-container" class="w-full max-w-2xl bg-white bg-opacity-10 backdrop-filter backdrop-blur-lg rounded-xl shadow-2xl p-6 md:p-10 text-center flex flex-col items-center">

        <!-- Initial "Open Present" Screen -->
        <div id="initial-screen" class="flex flex-col items-center justify-center space-y-6">
            <h1 class="text-4xl md:text-5xl font-bold mb-4 animate-pulse">It's a Present for You!</h1>
            <p class="text-lg md:text-xl text-gray-300">Tap to see what's inside.</p>
            <button id="open-button" class="mt-8 bg-pink-500 hover:bg-pink-600 transition-colors duration-300 text-white font-bold py-4 px-8 rounded-full text-lg shadow-lg transform hover:scale-105">
                Open Present!
            </button>
        </div>

        <!-- Present Content Screen (Initially Hidden) -->
        <div id="present-screen" class="hidden w-full space-y-6">
            <h2 class="text-3xl md:text-4xl font-bold text-yellow-300">Happy Birthday! ðŸŽ‰</h2>

            <!-- The Video Container -->
            <div class="w-full flex justify-center">
                <!-- IMPORTANT: This is a placeholder video for testing. -->
                <!-- Replace the video 'src' with a direct link to your own video file. -->
                <video id="present-video" controls autoplay muted playsinline class="w-full max-h-96 rounded-xl shadow-lg border-4 border-yellow-300">
                    <source src="https://media.w3.org/2010/05/sintel/trailer.mp4" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
            </div>

            <!-- The Personal Message -->
            <p id="present-message" class="text-base md:text-lg text-gray-200 mt-4 leading-relaxed">
                This is a place for your personal message! Write something heartfelt and special here.
            </p>
            
            <hr class="border-t border-purple-400 my-6">

            <!-- Reaction Capture Section -->
            <div id="reaction-section" class="w-full mt-6 space-y-4">
                <h3 class="text-2xl font-bold text-purple-300">Your Reaction!</h3>
                <p class="text-gray-300">Let's capture this moment! Click below to turn on your camera and take a picture of your reaction.</p>
                
                <!-- Camera view and capture button -->
                <div class="flex flex-col items-center space-y-4">
                    <button id="start-camera-button" class="bg-purple-500 hover:bg-purple-600 transition-colors duration-300 text-white font-bold py-3 px-6 rounded-full shadow-md transform hover:scale-105">
                        Start Camera
                    </button>
                    
                    <video id="camera-preview" class="hidden camera-video w-full max-h-64 rounded-xl shadow-lg border-2 border-purple-300" autoplay playsinline></video>
                    
                    <button id="capture-button" class="hidden bg-green-500 hover:bg-green-600 transition-colors duration-300 text-white font-bold py-3 px-6 rounded-full shadow-md transform hover:scale-105">
                        Capture Reaction!
                    </button>
                    
                    <!-- This canvas is used to capture the image from the video stream -->
                    <canvas id="reaction-canvas" class="hidden"></canvas>
                </div>

                <!-- Display area for the captured reaction image -->
                <div id="captured-image-container" class="hidden mt-4 flex flex-col items-center space-y-4">
                    <h4 class="text-xl font-bold text-yellow-300">Your Captured Reaction!</h4>
                    <img id="captured-image" class="w-full max-w-sm rounded-xl shadow-lg border-4 border-yellow-300"/>
                    <p id="copy-message" class="text-sm text-gray-400">
                      Image data copied to clipboard! You can paste it to save it.
                    </p>
                </div>
            </div>
        </div>

    </div>

    <!-- Custom Message Box to replace `alert()` -->
    <div id="message-box" class="fixed inset-0 bg-black bg-opacity-70 hidden items-center justify-center p-4">
        <div class="bg-gray-800 text-white p-6 rounded-xl shadow-lg text-center max-w-sm">
            <p id="message-text" class="text-lg"></p>
            <button id="message-close-button" class="mt-4 bg-purple-500 hover:bg-purple-600 transition-colors duration-300 text-white font-bold py-2 px-4 rounded-full">
                OK
            </button>
        </div>
    </div>

    <script>
        // Use a custom message box instead of alert()
        function showMessage(message) {
            const messageBox = document.getElementById('message-box');
            const messageText = document.getElementById('message-text');
            const messageCloseButton = document.getElementById('message-close-button');

            messageText.textContent = message;
            messageBox.classList.remove('hidden');
            messageBox.classList.add('flex');

            messageCloseButton.onclick = () => {
                messageBox.classList.add('hidden');
                messageBox.classList.remove('flex');
            };
        }

        window.onload = function() {
            // Get all the necessary DOM elements
            const initialScreen = document.getElementById('initial-screen');
            const presentScreen = document.getElementById('present-screen');
            const openButton = document.getElementById('open-button');
            const presentVideo = document.getElementById('present-video');
            const startCameraButton = document.getElementById('start-camera-button');
            const cameraPreview = document.getElementById('camera-preview');
            const captureButton = document.getElementById('capture-button');
            const reactionCanvas = document.getElementById('reaction-canvas');
            const capturedImageContainer = document.getElementById('captured-image-container');
            const capturedImage = document.getElementById('captured-image');
            const copyMessage = document.getElementById('copy-message');
            
            let stream = null; // To store the camera stream

            // Event listener for the "Open Present" button
            openButton.addEventListener('click', () => {
                // First, show the present screen
                initialScreen.classList.add('hidden');
                presentScreen.classList.remove('hidden');
                
                // Attempt to play the video and handle potential errors
                const playPromise = presentVideo.play();
                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        // Autoplay started successfully
                    }).catch(error => {
                        // Autoplay was prevented. Show a message to the user.
                        console.error("Autoplay was prevented:", error);
                        presentVideo.muted = false; // Unmute the video
                        showMessage('Please tap the play button on the video to start it.');
                    });
                }
            });

            // Event listener for the "Start Camera" button
            startCameraButton.addEventListener('click', async () => {
                try {
                    // Request access to the user's camera
                    stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });
                    cameraPreview.srcObject = stream;
                    
                    // Show the video preview and the capture button
                    cameraPreview.classList.remove('hidden');
                    captureButton.classList.remove('hidden');
                    startCameraButton.classList.add('hidden');
                    
                    // Hide the 'copy success' message initially
                    copyMessage.classList.add('hidden');

                } catch (err) {
                    console.error('Error accessing the camera: ', err);
                    showMessage('Permission to access the camera was denied. Please allow camera access in your browser settings to use this feature.');
                }
            });

            // Event listener for the "Capture Reaction" button
            captureButton.addEventListener('click', () => {
                if (stream) {
                    // Set canvas dimensions to match the video feed
                    reactionCanvas.width = cameraPreview.videoWidth;
                    reactionCanvas.height = cameraPreview.videoHeight;
                    
                    // Draw the current video frame onto the canvas
                    const context = reactionCanvas.getContext('2d');
                    context.drawImage(cameraPreview, 0, 0, reactionCanvas.width, reactionCanvas.height);
                    
                    // Convert the canvas content to an image data URL
                    const imageDataUrl = reactionCanvas.toDataURL('image/png');
                    capturedImage.src = imageDataUrl;
                    
                    // Display the captured image
                    capturedImageContainer.classList.remove('hidden');

                    // Stop all camera tracks
                    stream.getTracks().forEach(track => track.stop());
                    stream = null; // Clear the stream variable
                    
                    // Hide the camera preview and capture button
                    cameraPreview.classList.add('hidden');
                    captureButton.classList.add('hidden');
                    
                    // Reset the camera button text
                    startCameraButton.textContent = 'Start Camera Again';
                    startCameraButton.classList.remove('hidden');
                    
                    // Copy the image data to the clipboard
                    // Using a custom function due to potential browser restrictions
                    copyImageToClipboard(imageDataUrl);
                } else {
                    showMessage('Please start the camera first!');
                }
            });
            
            // Function to copy image data URL to the clipboard
            // This is a workaround since direct clipboard access can be tricky in some environments
            function copyImageToClipboard(dataUrl) {
                // We create a temporary img element and a textarea to copy the base64 string
                const tempTextarea = document.createElement('textarea');
                tempTextarea.value = dataUrl;
                document.body.appendChild(tempTextarea);
                tempTextarea.select();
                try {
                    // Attempt to copy the text to the clipboard
                    const successful = document.execCommand('copy');
                    if (successful) {
                        copyMessage.classList.remove('hidden');
                    } else {
                        showMessage('Failed to copy image data to clipboard.');
                    }
                } catch (err) {
                    console.error('Copy to clipboard failed:', err);
                    showMessage('Failed to copy image data to clipboard.');
                }
                document.body.removeChild(tempTextarea);
            }
        };
    </script>

</body>
</html>
